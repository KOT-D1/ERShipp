"use strict";(()=>{var p=!1,l=top.__vtbag?.elementCrossing;m();function m(){if(l?.fun){if(self===top)return;top.document.title=self.document.title,top.history.replaceState(self.history.state,"",self.location.href),self.crossingStorage=l.fun}self.addEventListener("onpageswap"in self?"pageswap":"pagehide",d,{once:!0}),self.addEventListener("onpagereveal"in self?"pagereveal":"DOMContentLoaded",k,{once:!0})}function d(){self.crossingStorage?self.crossingStorage.setItem("@vtbag/element-crossing",u()):top.sessionStorage.setItem("@vtbag/element-crossing",JSON.stringify(u()))}function k(){if(performance?.navigation?.type===1||"navigation"in self&&self.navigation?.navigationType==="reload")return;let s,t;(t=self.crossingStorage)?s=t.getItem("@vtbag/element-crossing")??[]:(t=top.sessionStorage,s=JSON.parse(t.getItem("@vtbag/element-crossing")??"[]")),b(s)}function u(){let s=new Set,t=[];return self.document.querySelectorAll("[data-vtbag-x]").forEach(a=>{let e=y(a);e&&(s.has(e.id)&&console.error("[crossing]","non unique id",e.id),t.push(e),s.add(e.id))}),p&&console.log("[crossing]","retrieve",t),t}function y(s){function t(i,o){let[n,r]=i.split(":",2);if(!n)return console.error("[crossing]","syntax error:",i,"is not recognized as a valid specification in",o),["<none>",r];if(r===void 0)switch(r=n.slice(1),n[0]){case"#":n="id";break;case".":n="class";break;case"@":n="prop";break;case"-":n="style";break;case"~":n="anim";break;case"&":if(n="elem",l?.fun)break;default:console.error("[crossing]","syntax error:",i,"is not recognized as a valid specification in",o)}return[n,r]}let a=s.id,e=[];if(s.getAttribute("data-vtbag-x")?.trim().split(/\s+/).forEach(i=>{let[o,n]=t(i,s);switch(o){case"id":a=n;break;case"class":e.push({kind:o,key:n,value:s.classList.contains(n)?"true":"false"});break;case"style":e.push({kind:o,key:n,value:""+(s.style[n]??"")});break;case"bool":case"num":case"prop":let r=s[n],g=typeof r;e.push({kind:g==="boolean"?"bool":g==="number"?"num":"prop",key:n,value:""+r});break;case"anim":let c=s.getAnimations().filter(f=>f instanceof CSSAnimation&&f.animationName===n);c.length>1&&console.error("[crossing]",`retrieval: animation name ${n} is not unique for`,s),c.length>0&&e.push({kind:o,key:n,value:""+(c[0].currentTime??0)});break;case"elem":top?.__vtbag?.elementCrossing?.fun&&(self.crossingStorage.setItem(n,s),e.push({kind:o,key:n}));break;default:console.error("[crossing]","unknown kind",o);break}}),!a)console.error("[crossing]","missing id in",s);else return{id:a,timestamp:new Date().getTime(),specs:e}}function b(s){p&&console.log("[crossing]","restore",s),s.forEach(t=>{let a=document.querySelector("#"+t.id+",[data-vtbag-x*='#"+t.id+"'],[data-vtbag-x*='id:"+t.id+"']");a&&t.specs.forEach(e=>{switch(e.kind){case"class":a.classList[e.value==="true"?"add":"remove"](e.key);break;case"style":e.key==="length"||e.key==="parentRule"?console.error("[crossing]","Cannot assign to read-only property",e.key,"in",t.id):a.style.setProperty(e.key,e.value??"");break;case"prop":a[e.key]=e.value;break;case"bool":a[e.key]=e.value==="true";break;case"num":a[e.key]=parseFloat(e.value??"0");break;case"anim":let i=a.getAnimations().filter(n=>n instanceof CSSAnimation&&n.animationName===e.key);i.length>1&&console.warn("[crossing]",`restore: animation name ${e.key} is not unique for`,a),i.forEach(n=>n.currentTime=~~(e.value??"0")+(new Date().getTime()-t.timestamp));break;case"elem":if(top?.__vtbag?.elementCrossing?.fun){let n=self.crossingStorage.getItem(e.key);n&&(a.replaceWith(n),a=n)}break;default:console.error("[crossing]","unknown kind",e.kind);break}})})}})();
